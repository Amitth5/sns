<script src="https://code.jquery.com/jquery-3.6.1.min.js" integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

<script src="https://cdn.jsdelivr.net/npm/underscore@latest/underscore-umd-min.js"></script>


<div class="container" style="margin-top: 50px;">


  <!-- Button trigger modal -->
<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#exampleModalCenter">
  Todays Records
</button>

<!-- Modal -->
<div class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLongTitle">Enter Todays Details</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">

        <div class="form-group">
          <label for="exampleInputEmail1">Customer Name</label>
          <input type="text" class="form-control" id="customer_name"  placeholder="Customer Name">
      </div>
      
      
      <div class="form-group">
          <label for="exampleInputEmail1">Restaurant Name</label>
          <input type="text" class="form-control" id="resto_name"  placeholder="Restaurant Name">
      </div>
      
      <div class="form-group">
          <label for="exampleFormControlSelect1">Select Delivery Boy</label>
          <select class="form-control" id="delivery_boy">
            <option value="96">Amit</option>
            <option value="674">Krishna</option>
            <option value="1084">Rahul Parmar</option>
            <option value="885">Sameer</option>
            <option value="1697">Subhash</option>
            <option value="1551">Sunil</option>
            <option value="2733">Rohit Dhanke</option>
            <option value="97">Vinay Salve</option>
      
          </select>
      </div>
      
      <div class="form-group">
          <label for="exampleInputEmail1">Amount</label>
          <input type="text" class="form-control" id="amount"  placeholder="Amount">
      </div>
      
      <div class="form-group">
          <label for="exampleInputEmail1">Transaction Date</label>
          <input type="date" class="form-control" id="transaction_date"  placeholder="Date">
      </div>
      
      <div class="form-group">
          <label for="exampleFormControlSelect1">Status</label>
          <select class="form-control" id="status">
            <option value="1">Pending</option>
            <option value="2">Offline Order</option>
            <option value="3">Hotel Payment</option>
            <option value="4">Refund</option>
            <option value="5">Payment to Amit</option>
          </select>
      </div>
      
      <div class="form-group">
          <label for="exampleFormControlTextarea1">Description</label>
          <textarea class="form-control" id="description" rows="3"></textarea>
      </div>
      </div>
      <div class="form-group">
        <div class="alert alert-danger"> Please fill all the details</div>
        <div class="alert alert-info"> Data saved !!</div>

      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="submit" id="submit" class="btn btn-primary">Save changes</button>
      </div>
    </div>
  </div>
</div>

    <div class="container fluid pull-left">
        <form method ="GET" action="http://3.94.170.142/transaction">
            <label for="birthday">Select Date:</label>
            <input type="date" id="date" name="date" class="form-control">
            <input type="submit" class="btn btn-info">
        </form>
    </div>




</div>

<div class="container fluid" style="margin-top:20px; margin-left:10%">
  <% if(dname == '000') { %>
    <h2>Total Sale: <%= data.totalOrderValue %> </h2>
    <h2>Total Delivery Deduction Deduction: <%=  data.deliveryDeduction  %></h2>
    <h2 style="color:green"> Rahul Release Payment: <%= data.rahulReleasePayment  -  data.deliveryDeduction %> </h2>
  <% } %>

  <% if(dname == 'sunil') { %>
    <h2>Total COD: <%= data.deliveryDetails[0]['COD'] %> </h2>
  <% } %>



<table class="table">
  <thead>
    <tr>
      <th scope="col">Delivery Partner</th>
      <th scope="col">Restaurant Name</th>
      <th scope="col">Customer Name</th>
      <th scope="col">Amount</th>
      <th scope="col">Status</th>
    </tr>
  </thead>
  <tbody>
  
  <% transactionData.forEach(function(product) { %>
<tr>
<% if(product.delivery_id == 1084){ %>
  <td scope="row"> Rahul Parmar </td>
 <% } else if (product.delivery_id == 1551){ %>  
  <td scope="row"> Sunil </td>
 <% } else if (product.delivery_id == 1697){ %>  
   <td scope="row"> Subhash </td>
  <% } else if (product.delivery_id == 885){ %>  
     <td scope="row"> Sameer </td>
  <% } else if (product.delivery_id == 674){ %>  
     <td scope="row"> Krishna </td>
  <% } else if (product.delivery_id == 96){ %>  
     <td scope="row"> Amit </td>
  <% } else if (product.delivery_id == 2887){ %>  
      <td scope="row"> Patil Rahul </td>
  <% } else if (product.delivery_id == 2805){ %>  
        <td scope="row"> Bhagwan Dawane </td>
  <% } else { %>   
    <td scope="row">Other </td>
  <% } %>   


  
  <td> <%= product.restaurant_name %> </td>
  <td> <%= product.customer_name %> </td>
  <td> <%= product.amount %> </td>
   <% if(product.status == 1){ %>
    <td scope="row"> Pending </td>
   <% } else if (product.status == 2){ %>  
    <td scope="row"> Offline Order </td>
   <% } else if (product.status == 3){ %>  
    <td scope="row"> Hotel Payment </td>
    <% } else if (product.status == 4){ %>  
    <td scope="row"> Refund / Discount </td>
    <% } else if (product.status == 5){ %>  
    <td scope="row"> Payment to Amit </td>
    <% }  %>  


</tr>
<% }); %>
  </tbody>
</table>
</div>
<script>
    $(document).ready(function(){
      $('.alert-danger').hide();
      $('.alert-info').hide();

      var data = '<%- JSON.stringify(data)  %>';
      var transactionData = '<%- JSON.stringify(transactionData)  %>';
      var dname = '<%- dname %>';
      console.log(dname);
      data = JSON.parse(data);
      console.log(data);
      console.log(transactionData);
      var dDetails = data.deliveryDetails;
      console.log(dDetails);
      
      if(dname !== '000'){
        var deliveryDetails = _.where(dDetails, {'name':dname});
        console.log(deliveryDetails);
      }

        $('#submit').click(function(){
            var customer_name = $('#customer_name').val();
            var resto_name = $('#resto_name').val();
            var delivery_boy = $('#delivery_boy').find(":selected").val()
            var status = $('#status').find(":selected").val();
            var description = $('#description').val();
            var transaction_date = $('#transaction_date').val();
            var amount = $('#amount').val().trim();
            
            var postData = {"customer_name": customer_name, "resto_name": resto_name, "delivery_boy": delivery_boy, "status": status, "amount": amount, "description": description, "transaction_date": transaction_date}
           if(customer_name.trim() != "" && resto_name.trim() != "" && transaction_date != "" && amount.trim() !=""){
            $.get( "http://3.94.170.142/inserttransaction",{"data":postData}, function(res , statua) {
              $('.alert-info').show();
              $('#customer_name').val('');
              $('#resto_name').val('');
              $('#amount').val('');
              $('.alert-danger').hide();

            });
          }else{
            $('.alert-info').hide();
            $('.alert-danger').show();
          }
        });
    });
</script>

<style>
  .form-group{
    margin-bottom: 15px;
  }
</style>
